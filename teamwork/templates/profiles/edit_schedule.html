{% extends 'base.html' %}
{% load staticfiles %}
{% load i18n %}

{# Clear out javascript block at bottom of page so we can import specific js #}
{% block javascript %}

{% endblock javascript %}

{% block stylesheets %}

  {{ block.super }}

  <!-- fullCalendar 2.2.5-->
  <link rel="stylesheet" href="{% static 'css/fullcalendar.min.css' %}">
  <link rel="stylesheet" href="{% static 'css/fullcalendar.print.css' %}" media="print">

{% endblock stylesheets %}


{% block content %}

<section class="content">
      <div class="row">
        <div class="col-md-9">
          <div class="box box-primary">
            <div class="box-body no-padding">
              <!-- THE CALENDAR -->
              <div id="calendar">

              </div>
              <!-- /.calendar -->
            </div>
            <!-- /.box-body -->
          </div>
          <!-- /. box -->
        </div>
        <!-- /.col -->
      </div>
      <!-- /.row -->
</section>



<script src="{% static 'js/jquery-2.2.3.min.js' %}"></script>
<script src="{% static 'js/bootstrap.min.js' %}"></script>
<script src="https://code.jquery.com/ui/1.11.4/jquery-ui.min.js"></script>

<!-- Slimscroll -->
<script src="{% static 'js/jquery.slimscroll.min.js' %}"></script>

<script src="{% static 'js/fastclick.js' %}"></script>

<script src="{% static 'js/app.min.js' %}"></script>

<script src="{% static 'js/moment.min.js' %}"></script>

<script src="{% static 'js/fullcalendar.min.js' %}"></script>

{% comment %}
<!-- jQuery 2.2.3 -->
<script async="" src="https://www.google-analytics.com/analytics.js"></script><script src="./staic/js/jquery-2.2.3.min.js"></script>
<!-- Bootstrap 3.3.6 -->
<script src="./static/js/bootstrap.min.js"></script>
<!-- jQuery UI 1.11.4 -->
<script src="./static/js/jquery-ui.min.js"></script>
<!-- Slimscroll -->
<script src="./static/js/jquery.slimscroll.min.js"></script>
<!-- FastClick -->
<script src="./static/js/fastclick.js"></script>
<!-- AdminLTE App -->
<script src="./static/js/app.min.js"></script>
<!-- AdminLTE for demo purposes -->
<script src="js/demo.js"></script>
<!-- fullCalendar 2.2.5 -->
<script src="/static/js/moment.min.js"></script>
<script src="/static/js/fullcalendar.js"></script>

{% endcomment %}


<!-- Page specific script -->

<script>

// using jQuery
function getCookie(name) {
    var cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        var cookies = document.cookie.split(';');
        for (var i = 0; i < cookies.length; i++) {
            var cookie = jQuery.trim(cookies[i]);
            // Does this cookie string begin with the name we want?
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}
var csrftoken = getCookie('csrftoken');


function save_one(eventData) {
    console.log("it's trying")
    $.ajax({
        type: "POST",
        url: "ajax/save_event/",
        headers: {
            "X-CSRFToken": csrftoken,
            "Content-Type": "application/json",
        },
        data: {
            'eventData' : JSON.stringify(eventData,null,2)
        },
        dataType: "json",
        success: function(data){
            console.log("success");
            console.log(data);
        },
        failure: function(data){
            console.log("failure");
            console.log(data);
        },
    });
    alert('save_one function ran.')
}
</script>
<script>
  $(function () {

  $('#calendar').fullCalendar({
      header: {
        left: 'none',
        center: 'title',
        right: 'agendaWeek'
      },
      defaultDate: '2017-04-12',
      defaultView: 'agendaWeek',
      navLinks: true, // can click day/week names to navigate views
      selectable: true,
      selectHelper: true,
      select: function(start, end) {
        var title = 'Busy';
        var eventData;
        if (title) {
          eventData = {
            title: title,
            start: start,
            end: end
          };
          //console.log("HI THERE" + eventData.start);
          $('#calendar').fullCalendar('renderEvent', eventData, true); // stick? = true
        }
        console.log($('#calendar').fullCalendar('clientEvents'));
        save_one(($('#calendar').fullCalendar('clientEvents')));
        $('#calendar').fullCalendar('unselect');
      },
      editable: true,
      eventLimit: true, // allow "more" link when too many events
      events: []
    });
  });

</script>



{% endblock content %}
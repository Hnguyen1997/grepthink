{% extends 'adminlte/base.html' %}

{% load static %}
{% load i18n %}


{% block content %}

<h2 class="page-header">
    {{ course.name }}
    <i class="fa fa-graduation-cap"></i>
    <i class="pull-right">
        <b>{{ course.term }}</b>
        {{ course.year }}
    </i>
</h2>

<div>
    <div class="nav-tabs-custom">
        <ul class="nav nav-tabs">
            <li class="active">
                <a href="#description" data-toggle="tab" aria-expanded="true">
                    Description
                    <i class="fa fa-info-circle"></i>
                </a>
            </li>
            <li class="">
                <a href="#projects" data-toggle="tab"aria-expanded="false">
                    Projects
                    <i class="fa fa-code-fork"></i>
                </a>
            </li>
            {% if user.profile.isProf %}
            <li class="">
                <a href="#members" data-toggle="tab" aria-expanded="false">
                    Members
                    <i class="fa fa-group"></i>
                </a>
            </li>
            {% endif %}
            <li class="pull-right">
                <a href="#admin" data-toggle="tab" aria-expanded="false">
                    <i class="fa fa-gear"></i>
                </a>
            </li>
        </ul>
        <div class="tab-content" style="background-color: #ecf0f5">
            <div class="tab-pane active" id="description">
                {% if user in course.students.all %}
                <p>You are enrolled in this course.</p>
                {% endif %}
                {% if user == course.creator %}
                <p>You created this course.</p>
                {% endif %}
                <p>User {{ user }}, course.creator {{ course.creator }}</p>
                <h3>Description</h3>
                {{ course.info }}
                <h3>Updates</h3>
                <ul class="timeline">
                    {% if user.profile.isProf %}
                    <li style="list-style: none"
                        onclick="window.location =
                        '{% url 'update_course' course.slug %}'">
                        <i class="fa fa-plus bg-green"></i>
                        <div class="timeline-item"
                            style="background-color: #ecf0f5">
                            <div class="timeline-header">
                                Add an update
                            </div>
                        </div>
                    </li>
                    {% endif %}
                    {% for date_update in date_updates %}
                    <li class="time-label" style="list-style: none">
                        <span class="bg-blue">
                            {{ date_update.date }}
                        </span>
                    </li>
                    {% for update in date_update.updates %}
                    <li style="list-style: none">
                        <i class="fa fa-comments bg-blue"></i>
                        <div class="timeline-item">
                            <div class="timeline-header clearfix">
                                {{ update.title }}
                                <!-- TODO: Make this only available for creator -->
                                <span class="pull-right">
                                    <a href='{% url 'delete_course_update' course.slug update.id %}'>
                                        <button class="btn btn-danger btn-xs">
                                            <i class="fa fa-trash"></i>
                                            Delete
                                        </button>
                                    </a>
                                    <a href='{% url 'update_course_update' course.slug update.id %}'>
                                        <button class="btn btn-success btn-xs">
                                            <i class="fa fa-edit"></i>
                                            Edit
                                        </button>
                                    </a>
                                </span>
                            </div>
                            <div class="timeline-body">
                                {{ update.content }}
                            </div>
                            <div class="timeline-footer clearfix">
                                <span class="label label-primary"
                                    onclick="window.location =
                                    '{% url 'profile' update.creator.username %}'">
                                    {{ update.creator.username }}
                                </span>
                                <i class="pull-right">
                                    Posted {{ update.date_post }}
                                    {% if update.date_post != update.date_edit %}
                                    , edited {{ update.date_edit }}
                                    {% endif %}
                                </i>
                            </div>
                        </div>
                    </li>
                    {% endfor %}
                    {% empty %}
                    There are no updates
                    {% endfor %}
                </ul>
            </div>
            <div class="tab-pane" id="projects">
                <div class="row">
                    {% for project in projects %}
                    <div class="col-sm-6 col-md-4">
                        <div class="panel panel-default"
                            onclick="window.location.href='{% url 'view_one_project' project.slug %}'">
                            <div class="panel-heading">
                                <h3 class="panel-title">{{ project.title }}</h3>
                            </div>
                            <div class="panel-body">
                                <p>
                                    <strong>Owner</strong>
                                    <span class="label label-success">
                                        {{ project.creator }}
                                    </span>
                                </p>
                                <p><strong>Members</strong>
                                    {% for mem in project.members.all %}
                                    {% if mem.username != null %}
                                    <span class="label label-primary">
                                        {{ mem.username }}
                                    </span>
                                    {% endif %}
                                    {% endfor %}
                                </p>
                            </div>
                        </div>
                    </div>
                    {% empty %}
                    <div class="alert alert-warning" role="alert">
                        <i class="fa fa-warning"></i>
                        There are no projects yet. Go ahead and
                        <a href="{% url 'create_project' %}" class="alert-link">
                            create one now!
                        </a>
                    </div>
                    {% endfor %}
                </div>
            </div>
            <div class="tab-pane" id="members">
                <h3>Instructor</h3>
                TODO: add instructor
                <h3>Students</h3>
                {% for studs in course.students.all %}
                {% if studs.username != null %}
                <span class="label label-primary">
                    {{ studs.username }}
                </span>
                <span> </span>
                {% endif %}
                {% endfor %}
            </div>
            {% if user.profile.isProf %}
            <div class="tab-pane" id="admin">
                <h3>Edit Course Info</h3>
                <p>
                    <a href="{% url 'edit_course' course.slug %}">
                        <button class="btn btn-success">
                            <i class="fa fa-edit"></i>
                            edit
                        </button>
                    </a>
                </p>
                <h3>Invite Students</h3>
                <p>
                    You can add students yourself in the <b>Edit Course</b> form
                    above, or have them add themselves using the addcode
                    provided below.
                </p>
                <p>
                    <b>Add Code:</b> <i>{{ course.addCode }}</i>
                </p>
            </div>
            {% endif %}
        </div>
    </div>
</div>

{% endblock content %}

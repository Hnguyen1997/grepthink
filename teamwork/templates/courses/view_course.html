{% extends 'base.html' %}

{% load static %}
{% load i18n %}

{% block content %}
<ol class="breadcrumb">
    <li><a href="{% url 'index' %}">Home</a></li>
    <li><a href="{% url 'view_course' %}">Courses</a></li>
    <li>
        <a href="{% url 'view_one_course' course.slug %}">
            {{ course.name }}
        </a>
    </li>
</ol>

<div>
    {% if user.username == course.creator %}
    <div class="alert alert-success" role="alert">
        You are an instructor of this course.
    </div>
    {% elif user not in course.students.all %}
    <div class="alert alert-warning" role="alert">
        <i class="fa fa-warning"></i>
        You are not a member of this course.
    </div>
    {% endif %}
    <div class="nav-tabs-custom">
        <ul class="nav nav-tabs">
            <li class="">
                <a href="#description" data-toggle="tab" aria-expanded="true">
                    Description
                    <i class="fa fa-info-circle"></i>
                </a>
            </li>
            <li class="active">
                <a href="#projects" data-toggle="tab"aria-expanded="false">
                    Projects
                    <i class="fa fa-code-fork"></i>
                </a>
            </li>
            <li class="">
                <a href="#members" data-toggle="tab" aria-expanded="false">
                    Members
                    <i class="fa fa-group"></i>
                </a>
            </li>
            {% if user.username == course.creator %}
            <li class="pull-right">
                <a href="#admin" data-toggle="tab" aria-expanded="false">
                    <i class="fa fa-gear"></i>
                </a>
            </li>
            {% endif %}
        </ul>

        <div class="tab-content" style="background-color: #ecf0f5">

            <div class="tab-pane active" id="projects">
                {% if user.username != course.creator %}
                  <div class="row">

                    <div class="alert alert-info" role="alert">
                        <a href="{% url 'show_interest' course.slug %}" class="alert-link">
                            Show interest in these projects!
                        </a>
                    </div>
                  </div>
                  {% endif %}


                    {% include "projects/partial_project_box.html" with projects=projects %}

            </div>

            <div class="tab-pane" id="description">
                <h3>Description</h3>
                {{ course.info }}
                <h3>Updates</h3>
                <ul class="timeline">
                    {% if user.username == course.creator %}
                    <li style="list-style: none"
                        onclick="window.location =
                        '{% url 'update_course' course.slug %}'">
                        <i class="fa fa-plus bg-green"></i>
                        <div class="timeline-item"
                            style="background-color: #ecf0f5">
                            <div class="timeline-header">
                                Add an update
                            </div>
                        </div>
                    </li>
                    {% endif %}
                    {% for date_update in date_updates %}
                    <li class="time-label" style="list-style: none">
                        <span class="bg-blue">
                            {{ date_update.date }}
                        </span>
                    </li>
                    {% for update in date_update.updates %}
                    <li style="list-style: none">
                        <i class="fa fa-comments bg-blue"></i>
                        <div class="timeline-item">
                            <div class="timeline-header clearfix">
                                {{ update.title }}
                                {% if user == update.creator %}
                                <span class="pull-right">
                                    <a href='{% url 'update_course_update' course.slug update.id %}'>
                                        <button class="btn btn-default btn-xs">
                                            <i class="fa fa-gear"></i>
                                        </button>
                                    </a>
                                </span>
                                {% endif %}
                            </div>
                            <div class="timeline-body">
                                {{ update.content }}
                            </div>
                            <div class="timeline-footer clearfix">
                                <span class="label label-primary"
                                    onclick="window.location =
                                    '{% url 'profile' update.creator.username %}'">
                                    {{ update.creator.username }}
                                </span>
                                <i class="pull-right">
                                    Posted {{ update.date_post }}
                                    {% if update.date_post != update.date_edit %}
                                    , edited {{ update.date_edit }}
                                    {% endif %}
                                </i>
                            </div>
                        </div>
                    </li>
                    {% endfor %}
                    {% empty %}
                    <li style="list-style: none">
                        <i class="fa fa-times bg-red"></i>
                        <div class="timeline-item"
                            style="background-color: #ecf0f5">
                            <div class="timeline-header">
                                There are no updates
                            </div>
                        </div>
                    </li>
                    {% endfor %}
                    <li style="list-style: none">
                        <i class="fa fa-clock-o"></i>
                    </li>
                </ul>
            </div>
            <div class="tab-pane" id="members">
                <h3>Instructor</h3>
                <span class="label label-success"
                    onclick="window.location =
                    '{% url 'profile' course.creator %}'">
                    {{ course.creator }}
                </span>
                <h3>Students</h3>
                {% for studs in course.students.all %}
                {% if studs.username != null %}
                <span class="label label-primary"
                    onclick="window.location =
                    '{% url 'profile' studs.username %}'">
                    {{ studs.username }}
                </span>
                <span> </span>
                {% endif %}
                {% empty %}
                <p>There are no students enrolled in this course</p>
                {% endfor %}
            </div>
            {% if user.username == course.creator %}
            <div class="tab-pane" id="admin">
                <h3>Edit Course Info</h3>
                <p>
                    <a href="{% url 'edit_course' course.slug %}">
                        <button class="btn btn-success">
                            <i class="fa fa-edit"></i>
                            Edit
                        </button>
                    </a>
                </p>
                <h3>View Class Statistics</h3>
                <p>
                    <a href="{% url 'view_statistics' course.slug %}">
                        <button class="btn btn-info">
                        <i class="fa fa-stats"></i>
                        Stats
                        </button>
                    </a>
                </p>

                <h3>Auto Generate Teams</h3>
                <p>
                    <a href="{% url 'auto_gen' course.slug %}">
                        <button class="btn btn-info">
                        Generate
                        </button>
                    </a>
                </p>

                <h3>Invite Students</h3>
                <p>
                    You can add students yourself in the <b>Edit Course</b> form
                    above, or have them add themselves using the addcode
                    provided below.
                </p>
                <p>
                    <b>Add Code:</b> <i>{{ course.addCode }}</i>
                </p>
            </div>
            {% endif %}
        </div>

    </div>
</div>

{% endblock content %}
